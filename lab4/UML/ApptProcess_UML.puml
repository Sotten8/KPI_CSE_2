@startuml ApptProcess
|Owner|
start
:Attend the Appointment;

|System|

|Vet|
:Request Appointment Data;

|System|
:Show Appointment Data;

|Vet|
:View Appointment Data;
:Start Appointment;

|System|
:Update Appointment Status to "in progress";

|Vet|
:Conduct Appointment;

if () then (Result is Diagnosed/Recovered)
  |Vet|
  :Write Conclusion info: Notes, Result, Diagnosis;
else (Result is Healthy)
  |Vet|
  :Write Conclusion Info: Notes, Result;
endif

|System|
:Update Info about Appointment;
:Request Payment;

|Owner|
:Choose Payment Way;

switch ()
case (OfflineCash)
  |Owner|
  :Pay by Cash;

  |Vet|
  :Accept Cash Payment;

case (OfflineCard)
  |Owner|
  :Pay by Card;

  |Vet|
  :Accept Card Payment;

case (Online)

  |System|
  :Show Payment Form;

  |Owner|
repeat
  :Fill Payment Form;
  :Send Form;
  |System|
  :Process Transaction;
repeat while () is (Fail) not (Success)
  
  |System|
  :Notify about Payment Completion;
  fork
  |System|
  :Notify Owner;
  :Send Owner Payment Notification;
  |Owner|
  :Receive Owner Payment Notification;
  :Read Notification;
  kill
fork again
  |System|
  :Notify Vet;
  :Send Vet Payment Notification;
  |Vet|
  :Receive Vet Payment Notification;
  :Read Notification;
end fork
endswitch

|Vet|
:End Appointment;
|System|
:Update Appointment Status;
:Update Appointment Status to "completed";
:Notify About Completed Appointment;
fork
  :Notify Owner;
  :Send Owner Completion Notification;
  |Owner|
  :Receive Owner Completion Notification;
  :Read Notification;
  kill
fork again
  |System|
  :Notify Vet;
  :Send Vet Completion Notification;
  |Vet|
  :Receive Vet Completion Notification;
  :Read Notification;
end fork
stop
@enduml